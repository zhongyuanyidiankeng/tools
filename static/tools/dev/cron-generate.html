<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="åœ¨çº¿Cronè¡¨è¾¾å¼ç”Ÿæˆå™¨ï¼Œæ”¯æŒ6å­—æ®µå’Œ7å­—æ®µæ ¼å¼">
  <title>Cron ç”Ÿæˆå™¨ - åœ¨çº¿å·¥å…·</title>
  <link rel="canonical" href="/static/tools/dev/cron-generate.html">
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    .cron-presets { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
    .cron-presets button { font-size: 0.875rem; padding: 0.4rem 0.8rem; }
    .field-type { margin-top: 0.5rem; }
    .field-type select { width: 100%; padding: 0.4rem; border: 1px solid #e2e8f0; border-radius: 4px; }
    .next-runs { margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; }
    .next-runs h4 { margin: 0 0 0.5rem 0; color: #475569; font-size: 0.9rem; }
    .next-runs ul { margin: 0; padding-left: 1.5rem; }
    .next-runs li { color: #64748b; font-family: monospace; margin: 0.3rem 0; }
    .cron-help { font-size: 0.75rem; color: #94a3b8; margin-top: 0.25rem; }
    .cron-format { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .cron-format label { display: flex; align-items: center; gap: 0.3rem; cursor: pointer; }
    .cron-fields { display: grid; gap: 1rem; }
    .cron-fields.fields-5 { grid-template-columns: repeat(5, 1fr); }
    .cron-fields.fields-6 { grid-template-columns: repeat(6, 1fr); }
    .cron-fields.fields-7 { grid-template-columns: repeat(7, 1fr); }
    @media (max-width: 768px) {
      .cron-fields { grid-template-columns: repeat(3, 1fr) !important; }
    }
  </style>
</head>
<body>
  <nav class="nav"><div class="container nav-content"><a href="/" class="nav-logo">ğŸ› ï¸ åœ¨çº¿å·¥å…·</a></div></nav>
  <div class="tool-page">
    <header class="page-header"><h1>Cron è¡¨è¾¾å¼ç”Ÿæˆå™¨</h1><p>å¯è§†åŒ–ç”Ÿæˆ Cron è¡¨è¾¾å¼ï¼Œæ”¯æŒå¤šç§æ ¼å¼å’ŒåŒ¹é…æ¨¡å¼</p></header>
    <div class="tool-box">
      <!-- Cron æ ¼å¼é€‰æ‹© -->
      <div class="form-group">
        <label>Cron æ ¼å¼</label>
        <div class="cron-format">
          <label><input type="radio" name="cronFormat" value="5" checked onchange="switchFormat(5)"> æ ‡å‡†5å­—æ®µ (åˆ† æ—¶ æ—¥ æœˆ å‘¨)</label>
          <label><input type="radio" name="cronFormat" value="6" onchange="switchFormat(6)"> 6å­—æ®µ (ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨)</label>
          <label><input type="radio" name="cronFormat" value="7" onchange="switchFormat(7)"> 7å­—æ®µ (ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ å¹´)</label>
        </div>
      </div>

      <!-- å¿«æ·é¢„è®¾ -->
      <div class="form-group">
        <label>å¿«æ·é¢„è®¾</label>
        <div class="cron-presets">
          <button class="btn" onclick="setPreset('every-minute')">æ¯åˆ†é’Ÿ</button>
          <button class="btn" onclick="setPreset('every-hour')">æ¯å°æ—¶</button>
          <button class="btn" onclick="setPreset('every-day')">æ¯å¤©0ç‚¹</button>
          <button class="btn" onclick="setPreset('every-day-8')">æ¯å¤©8ç‚¹</button>
          <button class="btn" onclick="setPreset('every-monday')">æ¯å‘¨ä¸€</button>
          <button class="btn" onclick="setPreset('every-month')">æ¯æœˆ1å·</button>
          <button class="btn" onclick="setPreset('every-5min')">æ¯5åˆ†é’Ÿ</button>
          <button class="btn" onclick="setPreset('every-30sec')">æ¯30ç§’</button>
        </div>
      </div>

      <!-- Cron å­—æ®µ -->
      <div id="cronFields" class="cron-fields fields-5">
        <!-- ç§’ (6/7å­—æ®µæ¨¡å¼) -->
        <div class="form-group" id="secondField" style="display:none">
          <label>ç§’ (0-59)</label>
          <div class="field-type">
            <select id="second_type" onchange="updateFieldInput('second')">
              <option value="*">æ¯ç§’ (*)</option>
              <option value="specific" selected>æŒ‡å®šå€¼</option>
              <option value="range">èŒƒå›´ (x-y)</option>
              <option value="step">é—´éš” (*/n)</option>
              <option value="list">åˆ—è¡¨ (x,y,z)</option>
            </select>
          </div>
          <input type="text" id="second" class="form-input" value="0" style="margin-top:0.5rem">
          <div class="cron-help">0-59</div>
        </div>

        <!-- åˆ†é’Ÿ -->
        <div class="form-group">
          <label>åˆ†é’Ÿ (0-59)</label>
          <div class="field-type">
            <select id="minute_type" onchange="updateFieldInput('minute')">
              <option value="*">æ¯åˆ†é’Ÿ (*)</option>
              <option value="specific" selected>æŒ‡å®šå€¼</option>
              <option value="range">èŒƒå›´ (x-y)</option>
              <option value="step">é—´éš” (*/n)</option>
              <option value="list">åˆ—è¡¨ (x,y,z)</option>
            </select>
          </div>
          <input type="text" id="minute" class="form-input" value="0" style="margin-top:0.5rem">
          <div class="cron-help">0-59</div>
        </div>

        <!-- å°æ—¶ -->
        <div class="form-group">
          <label>å°æ—¶ (0-23)</label>
          <div class="field-type">
            <select id="hour_type" onchange="updateFieldInput('hour')">
              <option value="*" selected>æ¯å°æ—¶ (*)</option>
              <option value="specific">æŒ‡å®šå€¼</option>
              <option value="range">èŒƒå›´ (x-y)</option>
              <option value="step">é—´éš” (*/n)</option>
              <option value="list">åˆ—è¡¨ (x,y,z)</option>
            </select>
          </div>
          <input type="text" id="hour" class="form-input" value="*" style="margin-top:0.5rem">
          <div class="cron-help">0-23</div>
        </div>

        <!-- æ—¥ -->
        <div class="form-group">
          <label>æ—¥ (1-31)</label>
          <div class="field-type">
            <select id="day_type" onchange="updateFieldInput('day')">
              <option value="*" selected>æ¯å¤© (*)</option>
              <option value="specific">æŒ‡å®šå€¼</option>
              <option value="range">èŒƒå›´ (x-y)</option>
              <option value="step">é—´éš” (*/n)</option>
              <option value="list">åˆ—è¡¨ (x,y,z)</option>
            </select>
          </div>
          <input type="text" id="day" class="form-input" value="*" style="margin-top:0.5rem">
          <div class="cron-help">1-31</div>
        </div>

        <!-- æœˆ -->
        <div class="form-group">
          <label>æœˆ (1-12)</label>
          <div class="field-type">
            <select id="month_type" onchange="updateFieldInput('month')">
              <option value="*" selected>æ¯æœˆ (*)</option>
              <option value="specific">æŒ‡å®šå€¼</option>
              <option value="range">èŒƒå›´ (x-y)</option>
              <option value="step">é—´éš” (*/n)</option>
              <option value="list">åˆ—è¡¨ (x,y,z)</option>
            </select>
          </div>
          <input type="text" id="month" class="form-input" value="*" style="margin-top:0.5rem">
          <div class="cron-help">1-12</div>
        </div>

        <!-- æ˜ŸæœŸ -->
        <div class="form-group">
          <label>æ˜ŸæœŸ (0-6)</label>
          <div class="field-type">
            <select id="weekday_type" onchange="updateFieldInput('weekday')">
              <option value="*" selected>æ¯å¤© (*)</option>
              <option value="specific">æŒ‡å®šå€¼</option>
              <option value="range">èŒƒå›´ (x-y)</option>
              <option value="list">åˆ—è¡¨ (x,y,z)</option>
            </select>
          </div>
          <input type="text" id="weekday" class="form-input" value="*" style="margin-top:0.5rem">
          <div class="cron-help">0=å‘¨æ—¥, 1-6=å‘¨ä¸€è‡³å‘¨å…­</div>
        </div>

        <!-- å¹´ (7å­—æ®µæ¨¡å¼) -->
        <div class="form-group" id="yearField" style="display:none">
          <label>å¹´</label>
          <div class="field-type">
            <select id="year_type" onchange="updateFieldInput('year')">
              <option value="*" selected>æ¯å¹´ (*)</option>
              <option value="specific">æŒ‡å®šå€¼</option>
              <option value="range">èŒƒå›´ (x-y)</option>
              <option value="list">åˆ—è¡¨ (x,y,z)</option>
            </select>
          </div>
          <input type="text" id="year" class="form-input" value="*" style="margin-top:0.5rem">
          <div class="cron-help">å¦‚ 2024, 2024-2030</div>
        </div>
      </div>

      <button class="btn btn-primary btn-block" onclick="generateCron()" style="margin-top:1rem">ç”Ÿæˆå¹¶è®¡ç®—æ‰§è¡Œæ—¶é—´</button>
      <div id="result" class="result-area"></div>
      
      <div class="form-group" style="margin-top:1rem">
        <label>Cron è¡¨è¾¾å¼</label>
        <input type="text" id="expression" class="form-input" readonly style="font-family:monospace;font-size:1.2rem;text-align:center">
      </div>
      <div class="form-group"><label>æè¿°</label><p id="description" style="color:#475569"></p></div>
      
      <!-- æœ€è¿‘æ‰§è¡Œæ—¶é—´ -->
      <div id="nextRunsContainer" class="next-runs" style="display:none">
        <h4>ğŸ“… æœ€è¿‘ 5 æ¬¡æ‰§è¡Œæ—¶é—´</h4>
        <ul id="nextRunsList"></ul>
      </div>
    </div>
  </div>
  <script src="/static/js/common.js"></script>
  <script>
    let cronFormat = 5;
    
    function switchFormat(format) {
      cronFormat = format;
      const fields = document.getElementById('cronFields');
      fields.className = `cron-fields fields-${format}`;
      
      document.getElementById('secondField').style.display = format >= 6 ? 'block' : 'none';
      document.getElementById('yearField').style.display = format === 7 ? 'block' : 'none';
    }
    
    function setPreset(preset) {
      const presets = {
        'every-minute': { second: '0', minute: '*', hour: '*', day: '*', month: '*', weekday: '*', year: '*' },
        'every-hour': { second: '0', minute: '0', hour: '*', day: '*', month: '*', weekday: '*', year: '*' },
        'every-day': { second: '0', minute: '0', hour: '0', day: '*', month: '*', weekday: '*', year: '*' },
        'every-day-8': { second: '0', minute: '0', hour: '8', day: '*', month: '*', weekday: '*', year: '*' },
        'every-monday': { second: '0', minute: '0', hour: '0', day: '*', month: '*', weekday: '1', year: '*' },
        'every-month': { second: '0', minute: '0', hour: '0', day: '1', month: '*', weekday: '*', year: '*' },
        'every-5min': { second: '0', minute: '*/5', hour: '*', day: '*', month: '*', weekday: '*', year: '*' },
        'every-30sec': { second: '*/30', minute: '*', hour: '*', day: '*', month: '*', weekday: '*', year: '*' }
      };
      
      const p = presets[preset];
      if (!p) return;
      
      document.getElementById('second').value = p.second;
      document.getElementById('minute').value = p.minute;
      document.getElementById('hour').value = p.hour;
      document.getElementById('day').value = p.day;
      document.getElementById('month').value = p.month;
      document.getElementById('weekday').value = p.weekday;
      document.getElementById('year').value = p.year;
      
      // æ›´æ–°ç±»å‹é€‰æ‹©å™¨
      ['second', 'minute', 'hour', 'day', 'month', 'weekday', 'year'].forEach(field => {
        updateTypeSelector(field, p[field]);
      });
      
      generateCron();
    }
    
    function updateTypeSelector(field, value) {
      const select = document.getElementById(field + '_type');
      if (!select) return;
      if (value === '*') select.value = '*';
      else if (value.includes('/')) select.value = 'step';
      else if (value.includes('-')) select.value = 'range';
      else if (value.includes(',')) select.value = 'list';
      else select.value = 'specific';
    }
    
    function updateFieldInput(field) {
      const type = document.getElementById(field + '_type').value;
      const input = document.getElementById(field);
      const defaults = { second: '0', minute: '0', hour: '0', day: '1', month: '1', weekday: '0', year: '2024' };
      
      switch(type) {
        case '*': input.value = '*'; break;
        case 'specific': input.value = defaults[field]; break;
        case 'range': 
          if (field === 'second' || field === 'minute') input.value = '0-30';
          else if (field === 'hour') input.value = '9-17';
          else if (field === 'year') input.value = '2024-2030';
          else input.value = '1-15';
          break;
        case 'step': input.value = field === 'second' ? '*/30' : field === 'minute' ? '*/5' : '*/2'; break;
        case 'list': input.value = field === 'weekday' ? '1,3,5' : field === 'year' ? '2024,2025,2026' : '1,15'; break;
      }
    }
    
    async function generateCron() {
      const data = {
        format: cronFormat,
        second: document.getElementById('second').value,
        minute: document.getElementById('minute').value,
        hour: document.getElementById('hour').value,
        day: document.getElementById('day').value,
        month: document.getElementById('month').value,
        weekday: document.getElementById('weekday').value,
        year: document.getElementById('year').value
      };
      
      const result = await apiRequest('/dev/cron-generate', {
        method: 'POST', 
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      
      if (result.success) {
        document.getElementById('expression').value = result.expression;
        document.getElementById('description').textContent = result.description;
        showResult('result', true, 'ç”ŸæˆæˆåŠŸ');
        
        // æ˜¾ç¤ºæœ€è¿‘æ‰§è¡Œæ—¶é—´
        if (result.next_runs && result.next_runs.length > 0) {
          document.getElementById('nextRunsContainer').style.display = 'block';
          const list = document.getElementById('nextRunsList');
          list.innerHTML = result.next_runs.map(time => {
            const date = new Date(time);
            return `<li>${formatDateTime(date)}</li>`;
          }).join('');
        } else {
          document.getElementById('nextRunsContainer').style.display = 'none';
        }
      } else {
        showResult('result', false, result.error_message);
        document.getElementById('nextRunsContainer').style.display = 'none';
      }
    }
    
    function formatDateTime(date) {
      const pad = n => n.toString().padStart(2, '0');
      const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
      return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())} (${weekdays[date.getDay()]})`;
    }
  </script>
</body>
</html>
