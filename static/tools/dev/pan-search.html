<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="åœ¨çº¿ç½‘ç›˜èµ„æºæœç´¢å·¥å…·">
  <title>ç½‘ç›˜æœç´¢ - åœ¨çº¿å·¥å…·</title>
  <link rel="canonical" href="/static/tools/dev/pan-search.html">
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    .search-box { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .search-box input { flex: 1; }
    .search-type { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .search-type label { display: flex; align-items: center; gap: 0.3rem; cursor: pointer; }
    .result-list { margin-top: 1rem; }
    .result-item { 
      padding: 1rem; 
      border: 1px solid #e2e8f0; 
      border-radius: 8px; 
      margin-bottom: 0.75rem;
      transition: box-shadow 0.2s;
    }
    .result-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .result-title { font-weight: 600; color: #1e40af; margin-bottom: 0.5rem; word-break: break-all; }
    .result-title a { color: inherit; text-decoration: none; }
    .result-title a:hover { text-decoration: underline; }
    .result-meta { font-size: 0.875rem; color: #64748b; }
    .result-meta span { margin-right: 1rem; }
    .pagination { display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem; }
    .pagination button { min-width: 40px; }
    .loading-text { text-align: center; color: #64748b; padding: 2rem; }
    .no-result { text-align: center; color: #64748b; padding: 2rem; }
  </style>
</head>
<body>
  <nav class="nav"><div class="container nav-content"><a href="/" class="nav-logo">ğŸ› ï¸ åœ¨çº¿å·¥å…·</a></div></nav>
  
  <div class="tool-page">
    <header class="page-header">
      <h1>ç½‘ç›˜æœç´¢</h1>
      <p>æœç´¢ç½‘ç›˜èµ„æºï¼Œæ”¯æŒå¤šç§ç½‘ç›˜ç±»å‹</p>
    </header>
    
    <div class="tool-box">
      <div class="search-box">
        <input type="text" id="keyword" class="form-input" placeholder="è¾“å…¥æœç´¢å…³é”®è¯..." onkeypress="if(event.key==='Enter')search()">
        <button class="btn btn-primary" onclick="search()">æœç´¢</button>
      </div>
      
      <div class="search-type">
        <label><input type="radio" name="panType" value="" checked> å…¨éƒ¨</label>
        <label><input type="radio" name="panType" value="aliyundrive"> é˜¿é‡Œäº‘ç›˜</label>
        <label><input type="radio" name="panType" value="quark"> å¤¸å…‹ç½‘ç›˜</label>
        <label><input type="radio" name="panType" value="baiduyun"> ç™¾åº¦ç½‘ç›˜</label>
      </div>
      
      <div id="result" class="result-list"></div>
      
      <div id="pagination" class="pagination" style="display:none">
        <button class="btn" onclick="changePage(-1)" id="prevBtn">ä¸Šä¸€é¡µ</button>
        <span id="pageInfo" style="line-height:36px;padding:0 1rem"></span>
        <button class="btn" onclick="changePage(1)" id="nextBtn">ä¸‹ä¸€é¡µ</button>
      </div>
    </div>
  </div>

  <script src="/static/js/common.js"></script>
  <script>
    let currentPage = 1;
    let currentKeyword = '';
    let totalPages = 1;
    
    function getSelectedType() {
      const selected = document.querySelector('input[name="panType"]:checked');
      return selected ? selected.value : '';
    }
    
    async function search(page = 1) {
      const keyword = document.getElementById('keyword').value.trim();
      if (!keyword) {
        document.getElementById('result').innerHTML = '<div class="no-result">è¯·è¾“å…¥æœç´¢å…³é”®è¯</div>';
        return;
      }
      
      currentKeyword = keyword;
      currentPage = page;
      
      document.getElementById('result').innerHTML = '<div class="loading-text">æœç´¢ä¸­...</div>';
      document.getElementById('pagination').style.display = 'none';
      
      const panType = getSelectedType();
      const result = await apiRequest('/dev/pan-search', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ keyword, page, pan_type: panType })
      });
      
      if (result.success && result.data && result.data.length > 0) {
        renderResults(result.data);
        totalPages = result.total_pages || 1;
        updatePagination();
      } else if (result.success) {
        document.getElementById('result').innerHTML = '<div class="no-result">æœªæ‰¾åˆ°ç›¸å…³èµ„æº</div>';
      } else {
        document.getElementById('result').innerHTML = `<div class="no-result">æœç´¢å¤±è´¥: ${result.error_message || 'æœªçŸ¥é”™è¯¯'}</div>`;
      }
    }
    
    function renderResults(data) {
      const panTypeNames = {
        'baidu': 'ç™¾åº¦ç½‘ç›˜',
        'aliyun': 'é˜¿é‡Œäº‘ç›˜',
        'quark': 'å¤¸å…‹ç½‘ç›˜',
        '115': '115ç½‘ç›˜',
        'xunlei': 'è¿…é›·äº‘ç›˜'
      };
      
      const html = data.map(item => {
        const panName = panTypeNames[item.pan_type] || item.pan_type || 'ç½‘ç›˜';
        const hasUrl = item.url && item.url.length > 0;
        const titleHtml = hasUrl 
          ? `<a href="${item.url}" target="_blank">${escapeHtml(item.title || 'æœªçŸ¥èµ„æº')}</a>`
          : escapeHtml(item.title || 'æœªçŸ¥èµ„æº');
        
        return `
          <div class="result-item">
            <div class="result-title">${titleHtml}</div>
            <div class="result-meta">
              <span>ğŸ“ ${panName}</span>
              ${item.password ? `<span>ğŸ”‘ å¯†ç : ${item.password}</span>` : ''}
              ${item.time ? `<span>ğŸ• ${formatTime(item.time)}</span>` : ''}
              ${item.source ? `<span>ğŸ“¢ ${item.source}</span>` : ''}
            </div>
          </div>
        `;
      }).join('');
      document.getElementById('result').innerHTML = html;
    }
    
    function formatTime(timeStr) {
      if (!timeStr) return '';
      try {
        const date = new Date(timeStr);
        if (isNaN(date.getTime())) return timeStr;
        return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
      } catch {
        return timeStr;
      }
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function updatePagination() {
      document.getElementById('pagination').style.display = 'flex';
      document.getElementById('pageInfo').textContent = `ç¬¬ ${currentPage} é¡µ / å…± ${totalPages} é¡µ`;
      document.getElementById('prevBtn').disabled = currentPage <= 1;
      document.getElementById('nextBtn').disabled = currentPage >= totalPages;
    }
    
    function changePage(delta) {
      const newPage = currentPage + delta;
      if (newPage >= 1 && newPage <= totalPages) {
        search(newPage);
      }
    }
  </script>
</body>
</html>
