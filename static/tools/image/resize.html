<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="åœ¨çº¿å›¾ç‰‡è°ƒæ•´å°ºå¯¸å·¥å…· - è°ƒæ•´å›¾ç‰‡åˆ°ç²¾ç¡®å°ºå¯¸æˆ–æŒ‰æ¯”ä¾‹ç¼©æ”¾">
  <title>è°ƒæ•´å°ºå¯¸ - åœ¨çº¿å·¥å…·</title>
  <link rel="canonical" href="/static/tools/image/resize.html">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <nav class="nav"><div class="container nav-content"><a href="/" class="nav-logo">ğŸ› ï¸ åœ¨çº¿å·¥å…·</a></div></nav>
  
  <div class="tool-page">
    <header class="page-header">
      <h1>è°ƒæ•´å°ºå¯¸</h1>
      <p>è°ƒæ•´å›¾ç‰‡åˆ°ç²¾ç¡®å°ºå¯¸æˆ–æŒ‰æ¯”ä¾‹ç¼©æ”¾</p>
    </header>
    
    <div class="tool-box">
      <div id="uploadArea" class="upload-area">
        <input type="file" accept="image/*">
        <div class="upload-icon">ğŸ“·</div>
        <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</p>
        <p id="fileInfo" style="margin-top:0.5rem;color:#3b82f6"></p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1.5rem">
        <div class="form-group">
          <label for="width">ç›®æ ‡å®½åº¦ (px)</label>
          <input type="number" id="width" class="form-input" value="800" min="1">
        </div>
        <div class="form-group">
          <label for="height">ç›®æ ‡é«˜åº¦ (px)</label>
          <input type="number" id="height" class="form-input" value="600" min="1">
        </div>
      </div>

      <div class="form-group">
        <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer">
          <input type="checkbox" id="keepAspect" checked>
          ä¿æŒå®½é«˜æ¯”ï¼ˆå›¾ç‰‡ä¼šç¼©æ”¾åˆ°æŒ‡å®šå°ºå¯¸å†…ï¼Œä¸ä¼šå˜å½¢ï¼‰
        </label>
      </div>

      <div class="form-group">
        <label for="quality">è¾“å‡ºè´¨é‡: <span id="qualityValue">85</span>%</label>
        <input type="range" id="quality" min="10" max="100" value="85" 
               oninput="document.getElementById('qualityValue').textContent=this.value">
      </div>

      <button id="resizeBtn" class="btn btn-primary btn-block" onclick="resizeImage()" disabled>
        è°ƒæ•´å°ºå¯¸
      </button>
      <div id="resizeBtn-loading" class="loading"><span class="spinner"></span> å¤„ç†ä¸­...</div>

      <div id="result" class="result-area"></div>
    </div>
  </div>

  <script src="/static/js/common.js"></script>
  <script>
    let fileId = null;
    
    new FileUploader('uploadArea', {
      onFileSelect: async (files) => {
        const file = files[0];
        document.getElementById('fileInfo').textContent = 
          `${file.name} (${formatFileSize(file.size)})`;
        
        const result = await uploadFile(file, '/image/upload');
        if (result.success) {
          fileId = result.file_id;
          document.getElementById('resizeBtn').disabled = false;
        } else {
          showResult('result', false, result.error_message || 'ä¸Šä¼ å¤±è´¥');
        }
      }
    });
    
    async function resizeImage() {
      if (!fileId) return;
      
      const width = parseInt(document.getElementById('width').value);
      const height = parseInt(document.getElementById('height').value);
      const keepAspect = document.getElementById('keepAspect').checked;
      const quality = parseInt(document.getElementById('quality').value);
      
      setLoading('resizeBtn', true);
      
      const result = await apiRequest('/image/resize-exact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          file_id: fileId, 
          width, 
          height, 
          keep_aspect: keepAspect,
          quality 
        })
      });
      
      setLoading('resizeBtn', false);
      
      if (result.success) {
        showResult('result', true, 
          `è°ƒæ•´æˆåŠŸï¼<a href="${result.download_url}" download>ç‚¹å‡»ä¸‹è½½</a>`);
      } else {
        showResult('result', false, result.error_message || 'å¤„ç†å¤±è´¥');
      }
    }
  </script>
</body>
</html>
